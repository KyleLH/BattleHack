<!DOCTYPE html>
<html ng-app="floc">
<head>

<meta charset="utf-8">
<title>Heatmaps</title>
<style>
    html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
    }


    #map-canvas div a img {
        display: none;
    }

</style>

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.css">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300,300italic,700&subset=latin,cyrillic-ext,latin-ext,cyrillic'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="components/multilevelpushmenu/jquery.multilevelpushmenu.css"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
    <script src="http://oss.maxcdn.com/libs/modernizr/2.6.2/modernizr.min.js"></script>
    <script src="components/multilevelpushmenu/jquery.multilevelpushmenu.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization"></script>
    <script src="/socket.io/socket.io.js"></script>

    <link rel="stylesheet" href="components/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css" type="text/css">
    <script src="components/seiyria-bootstrap-slider/dist/bootstrap-slider.min.js"></script>
    <link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap.css" type="text/css">
    <script src="components/bootstrap/dist/js/bootstrap.js"></script>

    <script>
        var loggedin = true;
        // TODO: GET request to check if you're logged in.
        var userType = "business";
        var arrMenu = [];

        if (!loggedin) {
            arrMenu = [
                {
                    title: "Floc",
                    id: 'menuID',
                    icon: 'fa fa-reorder',
                    items: [
                        {
                            name: 'Log In',
                            icon: 'fa fa-unlock-alt',
                            items: [
                                {
                                    title: 'Log In',
                                    items: [
                                        {
                                            name: 'User',
                                            id: 'loginUser',
                                            icon: 'fa fa-user',
                                            link: '#'
                                        },
                                        {
                                            name: 'Business',
                                            id: 'loginBusiness',
                                            icon: 'fa fa-users',
                                            link: '#'
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ];
        } else {
            if (userType === "user") {
                arrMenu = [
                {
                    title: "Floc",
                    id: 'menuID',
                    icon: 'fa fa-reorder',
                    items: [
                        {
                            name: "Kyle",
                            // icon: userIcon
                        },
                        {
                            name: 'Log Out',
                            icon: 'fa fa-lock',
                            id: 'logout',
                            link: '#'
                        }
                    ]
                }
            ];
            }  else {
                arrMenu = [
                {
                    title: "Floc",
                    id: 'menuID',
                    icon: 'fa fa-reorder',
                    items: [
                        {
                            name: 'Bertuccis',
                            id: 'buisnessName'
                            // icon: userIcon
                        },
                        {
                            name: 'Create Deal',
                            icon: 'fa fa-dollar',
                            id: 'createDeal',
                            link: '#'
                        },
                        {
                            name: 'Log Out',
                            icon: 'fa fa-lock',
                            id: 'logout',
                            link: '#'
                        }
                    ]
                }
            ];
            }
        }
    </script>

    <script>
        $(document).ready(function() {
            $('#menu').multilevelpushmenu({
                menu: arrMenu,
                collapsed: true,
                containersToPush: [$("#map-canvas")],
                menuWidth: "15%",
                menuHeight:"100%",
                onItemClick: function (event, obj, obj2) {
                    if (loggedin) {
                        if (obj2[0].innerText == $("#createDeal")[0].innerText) {
                            $("#myModal").modal();
                        } else if (obj2[0].innerText == $("#logout")[0].innerText) {
                            
                        }
                    } else if (obj2[0].innerText == $("#login")[0].innerText) {
                            
                    }
                }
            });
        });
        $(window).resize(function () {
            $( '#menu' ).multilevelpushmenu( 'redraw' );
        });
    </script>

<script>
    var socket = io('http://localhost');

    socket.on('connect', function sendLocation() {

        navigator.geolocation.getCurrentPosition(function(geoposition) {

            socket.emit('coordinates', {
                latitude: geoposition.coords.latitude,
                longitude: geoposition.coords.longitude
            });

        });

        console.log('sending location');


        setTimeout(sendLocation, 5000);

    });

    socket.on('log', function(msg) {
        console.log(msg);
    })


</script>

<script>
    var map, pointArray, heatmap;

    var people = [];

    var boston = new google.maps.LatLng(42.3561685, -71.0580716);

    function initialize() {
        var mapOptions = {
            zoom: 13,
            disableDefaultUI: true,
            center: boston,
            mapTypeId: google.maps.MapTypeId.SATELLITE
        };
        var myLatlng = new google.maps.LatLng(42.3500015, -71.05790016);
        map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);
        var contentString = '<div id="content">'+
              '<div id="siteNotice">'+
              '</div>'+
              '<h1 id="firstHeading" class="firstHeading">State Street Cafe</h1>'+
              '<div id="bodyContent">'+
              '<p>Bring 5 friends and get a <i>world renowned</i> eggs bennidict '+
              'free! Enjoy our various assortments of breakfast food.</p>'+
              '<p>Attribution: State Street Cafe, <a href="http://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
              'http://en.wikipedia.org/w/index.php?title=Uluru</a> '+
              '(last visited June 22, 2009).</p>'+
              '</div>'+
              '</div>';

          var infowindow = new google.maps.InfoWindow({
              content: contentString,
              minHeight: '1000px'
          });

          var marker = new google.maps.Marker({
              position: myLatlng,
              map: map,
              title: 'State Street Cafe'
          });
          google.maps.event.addListener(marker, 'click', function() {
            infowindow.open(map,marker);
          });

        pointArray = new google.maps.MVCArray(people);

        heatmap = new google.maps.visualization.HeatmapLayer({
            data: pointArray
        });

        heatmap.setMap(map);

        socket.on('coordinates', function(coordinates) {
            console.log('got coords', coordinates);
            people = coordinates.map(function(coordinate) {
                return new google.maps.LatLng(coordinate.latitude, coordinate.longitude)
            });

            pointArray.clear();

            people.forEach(function(person) {
                pointArray.push(person);
            });
        });
    }

    google.maps.event.addDomListener(window, 'load', initialize);


</script>
</head>

<body ng-controller="HomeController">
<div id="histSlider">
    <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="20" data-slider-step="1" data-slider-value="14"/>
</div>

<script>
$('#ex1').slider({
    formater: function(value) {
        return 'Current value: ' + value;
    }
});
$(document).ready(function() {
    $("#ex1").on("slideStop", function (event) {
        console.log("Slider has stopped at " + event.value);
    });
})
</script>

<style>
#ex1Slider .slider-selection {
    background: #BABABA;
}

#histSlider {
    margin-left: 43vw;
    margin-top: 90vh;
    margin-right: 43vw;
    position: absolute;
    z-index: 10;
}
</style>

<!-- Button trigger modal -->
<div ng-controller="createDealController">
<!-- <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
  Launch demo modal
</button> -->

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">New Deal</h4>
      </div>
      <div class="modal-body">
        <form  >
            <input class="newAddress form-control" type="text" placeholder="Address...">
            <br>
            <textarea class="newDescription form-control" placeholder="Details..."></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" ng-click="paypal()" >Pay with Paypal</button>
            <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="clearDeal()">Close</button>
            <button  class="btn btn-primary" type="button"  data-dismiss="modal" ng-click="createDeal()">Save changes</button>
          </div>
        </form>
    </div>
  </div>
</div>
</div>
</div>

<span id="menu" style="position: absolute; z-index: 5;"></span>

<div id="map-canvas"></div>
</body>
</html>
