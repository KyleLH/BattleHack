<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Heatmaps</title>
    <style>
        html, body, #map-canvas {
            height: 100%;
            margin: 0px;
            padding: 0px
        }

        #panel {
            position: absolute;
            top: 5px;
            left: 50%;
            margin-left: -180px;
            z-index: 5;
            background-color: #fff;
            padding: 5px;
            border: 1px solid #999;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization"></script>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        var socket = io('http://10.13.104.103');

        socket.on('connect', function sendLocation() {

            navigator.geolocation.getCurrentPosition(function(geoposition) {

                socket.emit('coordinates', {
                    latitude: geoposition.coords.latitude,
                    longitude: geoposition.coords.longitude
                });

            });

            console.log('sending location');


            setTimeout(sendLocation, 60000);

        });

        socket.on('log', function(msg) {
            console.log(msg);
        })


    </script>

    <script>
        var map, pointArray, heatmap;

        var people = [];

        var boston = new google.maps.LatLng(42.3561685, -71.0580716);

        function initialize() {
            var mapOptions = {
                zoom: 13,
                center: boston,
                mapTypeId: google.maps.MapTypeId.SATELLITE
            };

            map = new google.maps.Map(document.getElementById('map-canvas'),
                    mapOptions);

            pointArray = new google.maps.MVCArray(people);

            heatmap = new google.maps.visualization.HeatmapLayer({
                data: pointArray
            });

            heatmap.setMap(map);

            socket.on('coordinates', function(coordinates) {
                console.log('got coords', coordinates);
                people = coordinates.map(function(coordinate) {
                    return new google.maps.LatLng(coordinate.latitude, coordinate.longitude)
                });

                pointArray.clear();

                people.forEach(function(person) {
                    pointArray.push(person);
                });
//
//                heatmap = new google.maps.visualization.HeatmapLayer({
//                    data: pointArray
//                });
//
//                heatmap.setMap(map);
            });
        }

        google.maps.event.addDomListener(window, 'load', initialize);


    </script>
</head>

<body>
<div id="map-canvas"></div>
</body>
</html>